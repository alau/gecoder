<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Solving the Survo puzzle using Constraint Programming in Ruby</title>
  <link rel="stylesheet" type="text/css" href="../styles.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="../css/webgen.css" media="screen" />
  <meta name="description" content="An example showing how to solve a survo puzzle using constraint programming in Ruby with Gecode/R." />
  
</head>
<body>
<div id="header">
  <a class="logoLink" href="../index.html" title="Gecode/R - constraint programming in Ruby">
  <span>Gecode/R - constraint programming in Ruby</span>
  </a>
  <a name="top"></a>
</div>
<div id="contents">
  <div id="breadcrumbs"><a href="../index.html">Home</a> > <a href="index.html">Examples</a> > <span>Survo Puzzle</span></div>
  <div id="sidebarWrapper">
    <div id="sidebar">
      <h3>Examples</h3><ul id="secondNav"><li><a href="index.html">Overview</a></li><li><a href="send-more-money.html">send+more=money</a></li><li><a href="send-most-money.html">send+most=money</a></li><li><a href="sudoku.html">Sudoku</a></li><li><a href="sudoku-set.html">Sudoku with sets</a></li><li><a href="n-queens.html">N-queens</a></li><li><a href="magic-sequence.html">Magic Sequence</a></li><li><a href="nonogram.html">Nonogram (Paint by Numbers)</a></li><li><a href="square-tiling.html">Square tiling</a></li><li><a href="minesweeper.html">Minesweeper</a></li><li><span>Survo Puzzle</span></li></ul>
      <h3>Shortcuts</h3>
      <ul class="section-links"><li><a href="#problem">Problem</a></li><li><a href="#code">Code</a></li><li><a href="#output">Output</a></li></ul>

      <form id="searchbox_000699377096513254569:zhhnzsrbzfu" action="http://www.google.com/cse" 
        onsubmit="pageTracker._trackPageview('/search/' + document.getElementById('q').value);">
        <fieldset>
          <legend>Search the site</legend>
          <input type="hidden" name="cx" value="000699377096513254569:zhhnzsrbzfu" />
          <input type="hidden" name="cof" value="FORID:0" />
          <input id="q" name="q" type="text" size="15" />
          <input type="submit" name="sa" value="Search" />
        </fieldset>
      </form>
    </div>
  </div>
  <div id="body">
    <h1>Survo Puzzle</h1>


	<h2 id="problem">Problem</h2>


	<blockquote>
		<p>Survo puzzle is a kind of logic puzzle presented (in April 2006) and
studied by Seppo Mustonen. The name of the puzzle is associated to
Mustonen&#8217;s Survo system which is a general environment for statistical
computing and related areas.</p>
	</blockquote>


	<blockquote>
		<p>In a Survo puzzle the task is to fill an m * n table by integers
1,2,...,m*n so that each of these numbers appears only once and their
row and column sums are equal to integers given on the bottom and the
right side of the table.  Often some of the integers are given readily
in the table in order to guarantee uniqueness of the solution and/or for
making the task easier. -
<a href="http://en.wikipedia.org/wiki/Survo_Puzzle">Wikipedia</a></p>
	</blockquote>


	<h2 id="code">Code</h2>


	<p><div class="CodeRay">
  <div class="code"><pre><span class="no">  1</span> require <span class="s"><span class="dl">'</span><span class="k">rubygems</span><span class="dl">'</span></span>
<span class="no">  2</span> require <span class="s"><span class="dl">'</span><span class="k">gecoder</span><span class="dl">'</span></span>
<span class="no">  3</span> require <span class="s"><span class="dl">'</span><span class="k">enumerator</span><span class="dl">'</span></span>
<span class="no">  4</span> 
<span class="no">  5</span> <span class="c"># Survo Puzzle in Gecode/R</span>
<span class="no">  6</span> <span class="c">#</span>
<span class="no">  7</span> <span class="c"># http://en.wikipedia.org/wiki/Survo_Puzzle</span>
<span class="no">  8</span> <span class="c"># &quot;&quot;&quot;</span>
<span class="no">  9</span> <span class="c"># Survo puzzle is a kind of logic puzzle presented (in April 2006) and studied </span>
<span class="no"> <strong>10</strong></span> <span class="c"># by Seppo Mustonen. The name of the puzzle is associated to Mustonen's </span>
<span class="no"> 11</span> <span class="c"># Survo system which is a general environment for statistical computing and </span>
<span class="no"> 12</span> <span class="c"># related areas.</span>
<span class="no"> 13</span> <span class="c"># </span>
<span class="no"> 14</span> <span class="c"># In a Survo puzzle the task is to fill an m * n table by integers 1,2,...,m*n so </span>
<span class="no"> 15</span> <span class="c"># that each of these numbers appears only once and their row and column sums are </span>
<span class="no"> 16</span> <span class="c"># equal to integers given on the bottom and the right side of the table. </span>
<span class="no"> 17</span> <span class="c"># Often some of the integers are given readily in the table in order to </span>
<span class="no"> 18</span> <span class="c"># guarantee uniqueness of the solution and/or for making the task easier.</span>
<span class="no"> 19</span> <span class="c"># &quot;&quot;&quot;</span>
<span class="no"> <strong>20</strong></span> <span class="c"># </span>
<span class="no"> 21</span> <span class="c"># See also</span>
<span class="no"> 22</span> <span class="c"># http://www.survo.fi/english/index.html</span>
<span class="no"> 23</span> <span class="c"># http://www.survo.fi/puzzles/index.html</span>
<span class="no"> 24</span> <span class="c">#</span>
<span class="no"> 25</span> <span class="c"># References:</span>
<span class="no"> 26</span> <span class="c"># Mustonen, S. (2006b). &quot;On certain cross sum puzzles&quot;, http://www.survo.fi/papers/puzzles.pdf </span>
<span class="no"> 27</span> <span class="c"># Mustonen, S. (2007b). &quot;Enumeration of uniquely solvable open Survo puzzles.&quot;, http://www.survo.fi/papers/enum_survo_puzzles.pdf </span>
<span class="no"> 28</span> <span class="c"># Kimmo Vehkalahti: &quot;Some comments on magic squares and Survo puzzles&quot;, http://www.helsinki.fi/~kvehkala/Kimmo_Vehkalahti_Windsor.pdf</span>
<span class="no"> 29</span> <span class="c"># R code: http://koti.mbnet.fi/tuimala/tiedostot/survo.R</span>
<span class="no"> <strong>30</strong></span> <span class="c">#</span>
<span class="no"> 31</span> <span class="c"># Compare with my other Survo Puzzle models</span>
<span class="no"> 32</span> <span class="c">#</span>
<span class="no"> 33</span> <span class="c"># - MiniZinc: http://www.hakank.org/minizinc/survo_puzzle.mzn</span>
<span class="no"> 34</span> <span class="c"># - JaCoP: http://www.hakank.org/JaCoP/SurvoPuzzle.java</span>
<span class="no"> 35</span> <span class="c"># - Choco: http://www.hakank.org/choco/SurvoPuzzle.java</span>
<span class="no"> 36</span> <span class="c">#</span>
<span class="no"> 37</span> <span class="c"># Model created by Hakan Kjellerstrand, hakank@bonetmail.com</span>
<span class="no"> 38</span> <span class="c"># See also my Gecode/R page: http://www.hakank.org/gecode_r</span>
<span class="no"> 39</span> <span class="c">#</span>
<span class="no"> <strong>40</strong></span> <span class="c"># Slight modifications made by Andreas Launila to keep the example in</span>
<span class="no"> 41</span> <span class="c"># line with the other example models.</span>
<span class="no"> 42</span> <span class="r">class</span> <span class="cl">SurvoPuzzle</span>
<span class="no"> 43</span>   include <span class="co">Gecode</span>::<span class="co">Mixin</span>
<span class="no"> 44</span>   
<span class="no"> 45</span>   <span class="c"># The +clues+ are given as an m*n matrix where 0 represents that the</span>
<span class="no"> 46</span>   <span class="c"># cell has no clue. The row sums and column sums are specified by the</span>
<span class="no"> 47</span>   <span class="c"># +rowsums+ array of length m, and the +colsums+ array of length n</span>
<span class="no"> 48</span>   <span class="c"># respectively.</span>
<span class="no"> 49</span>   <span class="r">def</span> <span class="fu">initialize</span>(clues, rowsums, colsums)
<span class="no"> <strong>50</strong></span>     r = rowsums.length <span class="c"># Number of rows </span>
<span class="no"> 51</span>     c = colsums.length <span class="c"># Number of columns</span>
<span class="no"> 52</span> 
<span class="no"> 53</span>     <span class="c"># Integer variables representing each cell in the m*n table.</span>
<span class="no"> 54</span>     cells_is_an int_var_matrix(r, c, <span class="i">1</span>..r*c)
<span class="no"> 55</span> 
<span class="no"> 56</span>     <span class="c"># Add the constraints.</span>
<span class="no"> 57</span>     <span class="c"># Each number must appear only once.</span>
<span class="no"> 58</span>     cells.must_be.distinct
<span class="no"> 59</span> 
<span class="no"> <strong>60</strong></span>     <span class="c"># The row sums must be satisfied.</span>
<span class="no"> 61</span>     cells.row_vectors.each_with_index <span class="r">do</span> |row, i| 
<span class="no"> 62</span>       row.sum.must == rowsums[i]
<span class="no"> 63</span>     <span class="r">end</span>
<span class="no"> 64</span> 
<span class="no"> 65</span>     <span class="c"># The column sums must be satisfied.</span>
<span class="no"> 66</span>     cells.column_vectors.each_with_index <span class="r">do</span> |column, i| 
<span class="no"> 67</span>       column.sum.must == colsums[i] 
<span class="no"> 68</span>     <span class="r">end</span>
<span class="no"> 69</span> 
<span class="no"> <strong>70</strong></span>     <span class="c"># The clues must be satisfied.</span>
<span class="no"> 71</span>     cells.row_size.times <span class="r">do</span> |i| 
<span class="no"> 72</span>       cells.column_size.times <span class="r">do</span> |j|
<span class="no"> 73</span>         cells[i,j].must == clues[i,j] <span class="r">if</span> clues[i,j] &gt; <span class="i">0</span>
<span class="no"> 74</span>       <span class="r">end</span>
<span class="no"> 75</span>     <span class="r">end</span>
<span class="no"> 76</span> 
<span class="no"> 77</span>     branch_on cells, <span class="sy">:variable</span> =&gt; <span class="sy">:smallest_size</span>, <span class="sy">:value</span> =&gt; <span class="sy">:min</span>
<span class="no"> 78</span>   <span class="r">end</span>
<span class="no"> 79</span> <span class="r">end</span>
<span class="no"> <strong>80</strong></span> 
<span class="no"> 81</span> <span class="r">class</span> <span class="cl">Vector</span>
<span class="no"> 82</span>   <span class="c"># A helper for summing the contents of a vector.</span>
<span class="no"> 83</span>   <span class="r">def</span> <span class="fu">sum</span>
<span class="no"> 84</span>     inject{ |sum, element| sum + element }
<span class="no"> 85</span>   <span class="r">end</span>
<span class="no"> 86</span> <span class="r">end</span>
<span class="no"> 87</span> 
<span class="no"> 88</span> <span class="c"># Default problem:</span>
<span class="no"> 89</span> <span class="c"># Survo puzzle 126/2008 (25) #363-33148</span>
<span class="no"> <strong>90</strong></span> <span class="c"># From http://www.survo.fi/puzzles/280708.txt</span>
<span class="no"> 91</span> rowsums = [<span class="i">32</span>,<span class="i">79</span>,<span class="i">60</span>]
<span class="no"> 92</span> colsums = [<span class="i">24</span>,<span class="i">22</span>,<span class="i">43</span>,<span class="i">35</span>,<span class="i">39</span>,<span class="i">8</span>]
<span class="no"> 93</span> clues = <span class="co">Matrix</span>[
<span class="no"> 94</span>          [ <span class="i">0</span>, <span class="i">4</span>, <span class="i">0</span>, <span class="i">0</span>, <span class="i">0</span>, <span class="i">0</span>,<span class="i">32</span>],
<span class="no"> 95</span>          [<span class="i">12</span>, <span class="i">0</span>, <span class="i">0</span>,<span class="i">16</span>,<span class="i">17</span>, <span class="i">0</span>,<span class="i">79</span>],
<span class="no"> 96</span>          [ <span class="i">0</span>, <span class="i">0</span>,<span class="i">15</span>, <span class="i">0</span>, <span class="i">0</span>, <span class="i">2</span>,<span class="i">60</span>],
<span class="no"> 97</span>         ]
<span class="no"> 98</span> 
<span class="no"> 99</span> survo_puzzle = <span class="co">SurvoPuzzle</span>.new(clues, rowsums, colsums)
<span class="no"><strong>100</strong></span> num_solutions = <span class="i">0</span>
<span class="no">101</span> survo_puzzle.each_solution <span class="r">do</span> |s| 
<span class="no">102</span>   num_solutions += <span class="i">1</span>
<span class="no">103</span>   puts <span class="s"><span class="dl">&quot;</span><span class="ch">\n</span><span class="k">Solution #</span><span class="il"><span class="idl">#{</span>num_solutions<span class="idl">}</span></span><span class="dl">&quot;</span></span>;
<span class="no">104</span>   <span class="c"># Print the solution.</span>
<span class="no">105</span>   s.cells.values.enum_slice(s.cells.column_size).each_with_index <span class="r">do</span> |row,i|
<span class="no">106</span>     row.each{ |element| printf(<span class="s"><span class="dl">'</span><span class="k">%3d </span><span class="dl">'</span></span>, element) }
<span class="no">107</span>     printf <span class="s"><span class="dl">'</span><span class="k"> = %3d </span><span class="dl">'</span></span>, rowsums[i]
<span class="no">108</span>     puts
<span class="no">109</span>   <span class="r">end</span>
<span class="no"><strong>110</strong></span>   colsums.size.times{ printf(<span class="s"><span class="dl">'</span><span class="k">%2s= </span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="dl">'</span></span>) }
<span class="no">111</span>   puts 
<span class="no">112</span>   colsums.each{ |element| printf(<span class="s"><span class="dl">'</span><span class="k">%3d </span><span class="dl">'</span></span>, element) }
<span class="no">113</span> <span class="r">end</span>
<span class="no">114</span> 
<span class="no">115</span> puts <span class="s"><span class="dl">&quot;</span><span class="ch">\n</span><span class="k">Number of solutions: </span><span class="il"><span class="idl">#{</span>num_solutions<span class="idl">}</span></span><span class="dl">&quot;</span></span>
<span class="no">116</span> 
</pre></div>
</div>
</p>


	<h2 id="output">Output</h2>


<pre>
Solution #1
  3   4  10   6   8   1  =  32 
 12  11  18  16  17   5  =  79 
  9   7  15  13  14   2  =  60 
  =   =   =   =   =   = 
 24  22  43  35  39   8 
Number of solutions: 1
</pre>
  </div>
  <div id="tabs"><ul><li><a href="../features.html">Features</a></li><li><a href="../installation.html">Installation</a></li><li class="selected"><a href="index.html">Examples</a></li><li><a href="../documentation/index.html">Documentation</a></li><li><a href="../details/index.html">Project Details</a></li></ul></div>
</div>
<div id="footerWrapper">
  <div id="footer"><ul><li><a href="#top">Top</a></li><li><a href="../features.html">Features</a></li><li><a href="../installation.html">Installation</a></li><li class="selected"><a href="index.html">Examples</a></li><li><a href="../documentation/index.html">Documentation</a></li><li><a href="../details/index.html">Project Details</a></li><li><a class="sitemap" href="../sitemap.html">Sitemap</a></li></ul></div>
</div>
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ?
  "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost +
  "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
   var pageTracker = _gat._getTracker("UA-546645-2");
   pageTracker._initData();
   pageTracker._trackPageview();
</script>
</body>
</html>