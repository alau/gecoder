<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Solving send+more=money using Constraint Programming in Ruby</title>
  <link rel="stylesheet" type="text/css" href="../styles.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="../css/webgen.css" media="screen" />
  <meta name="description" content="An example showing how to solve the send+more=money problem using constraint programming in Ruby with Gecode/R." />
  
</head>
<body>
<div id="header">
  <a class="logoLink" href="../index.html" title="Gecode/R - constraint programming in Ruby">
  <span>Gecode/R - constraint programming in Ruby</span>
  </a>
  <a name="top"></a>
</div>
<div id="contents">
  <div id="breadcrumbs"><a href="../index.html">Home</a> > <a href="index.html">Examples</a> > <span>send+more=money</span></div>
  <div id="sidebarWrapper">
    <div id="sidebar">
      <h3>Examples</h3><ul id="secondNav"><li><a href="index.html">Overview</a></li><li><span>send+more=money</span></li><li><a href="send-most-money.html">send+most=money</a></li><li><a href="sudoku.html">Sudoku</a></li><li><a href="sudoku-set.html">Sudoku with sets</a></li><li><a href="n-queens.html">N-queens</a></li><li><a href="magic-sequence.html">Magic Sequence</a></li><li><a href="nonogram.html">Nonogram (Paint by Numbers)</a></li><li><a href="square-tiling.html">Square tiling</a></li><li><a href="minesweeper.html">Minesweeper</a></li><li><a href="survo.html">Survo Puzzle</a></li></ul>
      <h3>Shortcuts</h3>
      <ul class="section-links"><li><a href="#problem">Problem</a></li><li><a href="#code">Code</a></li><li><a href="#output">Output</a></li><li><a href="#notes">Notes</a></li></ul>

      <form id="searchbox_000699377096513254569:zhhnzsrbzfu" action="http://www.google.com/cse" 
        onsubmit="pageTracker._trackPageview('/search/' + document.getElementById('q').value);">
        <fieldset>
          <legend>Search the site</legend>
          <input type="hidden" name="cx" value="000699377096513254569:zhhnzsrbzfu" />
          <input type="hidden" name="cof" value="FORID:0" />
          <input id="q" name="q" type="text" size="15" />
          <input type="submit" name="sa" value="Search" />
        </fieldset>
      </form>
    </div>
  </div>
  <div id="body">
    <h1>send+more=money</h1>


	<h2 id="problem">Problem</h2>


<pre>
   send
 + more
 ------
  money
</pre>

	<p>The problem is to, given the above equation, assign digits to each letter so 
that the equation holds when the letter are substituted with the assigned 
digits. No two letter may be assigned the same digit and the first letter of a 
word is not allowed to be assigned 0 (i.e. a number may not start with 0 in the 
equation).</p>


	<h2 id="code">Code</h2>


	<p><div class="CodeRay">
  <div class="code"><pre><span class="no"> 1</span> require <span class="s"><span class="dl">'</span><span class="k">rubygems</span><span class="dl">'</span></span>
<span class="no"> 2</span> require <span class="s"><span class="dl">'</span><span class="k">gecoder</span><span class="dl">'</span></span>
<span class="no"> 3</span> 
<span class="no"> 4</span> <span class="c"># Solves the send+more=money problem: </span>
<span class="no"> 5</span> <span class="c"># http://en.wikipedia.org/wiki/Send%2Bmore%3Dmoney</span>
<span class="no"> 6</span> solution = <span class="co">Gecode</span>.solve <span class="r">do</span>
<span class="no"> 7</span>   <span class="c"># A helper to make the linear equation a bit tidier. Takes a number of</span>
<span class="no"> 8</span>   <span class="c"># variables and computes the linear combination as if the variable</span>
<span class="no"> 9</span>   <span class="c"># were digits in a base 10 number. E.g. x,y,z becomes</span>
<span class="no"><strong>10</strong></span>   <span class="c"># 100*x + 10*y + z .</span>
<span class="no">11</span>   <span class="r">def</span> <span class="fu">equation_row</span>(*variables)
<span class="no">12</span>     variables.inject{ |result, variable| variable + result*<span class="i">10</span> }
<span class="no">13</span>   <span class="r">end</span>
<span class="no">14</span> 
<span class="no">15</span>   <span class="c"># Set up the variables. </span>
<span class="no">16</span>   <span class="c"># Let &quot;letters&quot; be an array of 8 integer variables with domain 0..9.</span>
<span class="no">17</span>   <span class="c"># The elements represents the letters s, e, n, d, m, o, r and y.</span>
<span class="no">18</span>   letters_is_an int_var_array(<span class="i">8</span>, <span class="i">0</span>..<span class="i">9</span>)
<span class="no">19</span>   s,e,n,d,m,o,r,y = letters
<span class="no"><strong>20</strong></span> 
<span class="no">21</span>   <span class="c"># Set up the constraints.</span>
<span class="no">22</span>   <span class="c"># The equation must hold.</span>
<span class="no">23</span>   (equation_row(s, e, n, d) + equation_row(m, o, r, e)).must ==
<span class="no">24</span>     equation_row(m, o, n, e, y)
<span class="no">25</span> 
<span class="no">26</span>   <span class="c"># The initial letters may not be 0.</span>
<span class="no">27</span>   s.must_not == <span class="i">0</span>
<span class="no">28</span>   m.must_not == <span class="i">0</span>
<span class="no">29</span> 
<span class="no"><strong>30</strong></span>   <span class="c"># All letters must be assigned different digits.</span>
<span class="no">31</span>   letters.must_be.distinct
<span class="no">32</span> 
<span class="no">33</span>   <span class="c"># Tell Gecode what variables we want to know the values of.</span>
<span class="no">34</span>   branch_on letters, <span class="sy">:variable</span> =&gt; <span class="sy">:smallest_size</span>, <span class="sy">:value</span> =&gt; <span class="sy">:min</span>
<span class="no">35</span> <span class="r">end</span>
<span class="no">36</span> 
<span class="no">37</span> puts <span class="s"><span class="dl">'</span><span class="k">s e n d m o r y</span><span class="dl">'</span></span>
<span class="no">38</span> puts solution.letters.values.join(<span class="s"><span class="dl">'</span><span class="k"> </span><span class="dl">'</span></span>)
</pre></div>
</div>
</p>


	<h2 id="output">Output</h2>


	<pre><code>s e n d m o r y
9 5 6 7 1 0 8 2</code></pre>


	<h2 id="notes">Notes</h2>


	<p><a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/256221">A more general 
solution</a> 
is available as a submission to 
<a href="http://www.rubyquiz.com/quiz128.html">Ruby Quiz #128 &#8211; Verbal Arithmetic</a>.</p>
  </div>
  <div id="tabs"><ul><li><a href="../features.html">Features</a></li><li><a href="../installation.html">Installation</a></li><li class="selected"><a href="index.html">Examples</a></li><li><a href="../documentation/index.html">Documentation</a></li><li><a href="../details/index.html">Project Details</a></li></ul></div>
</div>
<div id="footerWrapper">
  <div id="footer"><ul><li><a href="#top">Top</a></li><li><a href="../features.html">Features</a></li><li><a href="../installation.html">Installation</a></li><li class="selected"><a href="index.html">Examples</a></li><li><a href="../documentation/index.html">Documentation</a></li><li><a href="../details/index.html">Project Details</a></li><li><a class="sitemap" href="../sitemap.html">Sitemap</a></li></ul></div>
</div>
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ?
  "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost +
  "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
   var pageTracker = _gat._getTracker("UA-546645-2");
   pageTracker._initData();
   pageTracker._trackPageview();
</script>
</body>
</html>